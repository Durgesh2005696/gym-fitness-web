// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



model User {
  id                    String    @id @default(uuid())
  name                  String
  email                 String    @unique
  password              String
  role                  String      @default("CLIENT")
  isActive              Boolean   @default(false)
  subscriptionExpiresAt DateTime?
  loginToken            String?   // For single device login restriction
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  // Relations
  trainerProfile TrainerProfile?
  clientProfile  ClientProfile?
  payments       Payment[]
  
  // For Trainer: Clients managed by this trainer
  managedClients ClientProfile[] @relation("TrainerClients")
}

model TrainerProfile {
  id             String @id @default(uuid())
  userId         String @unique
  user           User   @relation(fields: [userId], references: [id])
  specialization String?
  bio            String?
}

model ClientProfile {
  id                  String @id @default(uuid())
  userId              String @unique
  user                User   @relation(fields: [userId], references: [id])
  currentWeight       Float?
  height              Float?
  dietaryRestrictions String?
  
  // Assigned Trainer
  trainerId String?
  trainer   User?   @relation("TrainerClients", fields: [trainerId], references: [id])
  
  plans Plan[]
  logs  Log[]
}

model Plan {
  id              String   @id @default(uuid())
  clientProfileId String
  client          ClientProfile @relation(fields: [clientProfileId], references: [id])
  type            String
  data            String   // JSON string containing plan details (meals or exercises)
  validUntil      DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Log {
  id              String   @id @default(uuid())
  clientProfileId String
  client          ClientProfile @relation(fields: [clientProfileId], references: [id])
  type            String
  value           String   // "2.5" (liters), "75.5" (kg), or "Great workout!"
  date            DateTime @default(now())
}

model Payment {
  id            String        @id @default(uuid())
  userId        String
  user          User          @relation(fields: [userId], references: [id])
  amount        Float
  screenshotUrl String?
  status        String @default("PENDING")
  createdAt     DateTime      @default(now())
}
